!function(){"use strict";class e{constructor(e){let{data:t,cardSelector:s,handlePreviewImage:r,handleLikeCard:n,currentUserId:o,handleDeleteCard:i,owner:a}=e;this._name=t.name,this._link=t.link,this._likes=t.likes,this._id=t._id,this._cardSelector=s,this._handleImageClick=r,this._handleLikeCard=n,this._currentUserId=o,this._owner=t.owner._id,this._handleDeleteCard=i,console.log(this._owner)}_getTemplate(){const e=document.querySelector(this._cardSelector).content.firstElementChild.cloneNode(!0);return this._cardLikes=e.querySelector(".card__likes-amount"),e}deleteClick(){this._element.remove()}updateLikes(e){this._likes=e,this.renderLikes()}renderLikes(){this._cardLikes.textContent=this._likes.length,this.isLiked()?this.likeButton.classList.add("card__like-button_active"):this.likeButton.classList.remove("card__like-button_active")}isLiked(){return this._likes.some((e=>e._id===this._currentUserId))}_checkIdForDelete(){this._owner!==this._currentUserId&&this.removeTrash()}removeTrash(){this.cardTrashButton.remove()}_setEventListeners(){this.likeButton.addEventListener("click",(()=>this._handleLikeCard(this.isLiked()))),this.cardTrashButton.addEventListener("click",(()=>{this._handleDeleteCard(this._id)})),this.cardImage.addEventListener("click",(()=>{this._handleImageClick()}))}generateCard(){this._element=this._getTemplate(),this.likeButton=this._element.querySelector(".card__like-button"),this.cardTrashButton=this._element.querySelector(".card__delete-button"),this.cardImage=this._element.querySelector(".card__image");const e=this._element.querySelector(".card__title");return this._cardLikes=this._element.querySelector(".card__like-amount"),this.cardImage.src=this._link,this.cardImage.alt=this._name,e.textContent=this._name,this._setEventListeners(),this._checkIdForDelete(),this._element}}var t=class{constructor(e,t){this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass,this._form=e,this._buttonElement=this._form.querySelector(this._submitButtonSelector),this._inputElements=Array.from(this._form.querySelectorAll(this._inputSelector))}_showInputError(e){const t=this._form.querySelector(`#${e.id}-error`);e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)}_hideInputError(e){const t=this._form.querySelector(`#${e.id}-error`);e.classList.remove(this._inputErrorClass),t.textContent="",t.classList.remove(this._errorClass)}resetValidation(){this._inputElements.forEach((e=>{this._hideInputError(e)})),this.toggleButtonState()}toggleButtonState(){this._hasInvalidInput()?this._disableButton():this._enableButton()}_hasInvalidInput(){return this._inputElements.some((e=>!e.validity.valid))}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_disableButton(){this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.disabled=!0}_enableButton(){this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.disabled=!1}_setEventListeners(){this._inputElements.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this.toggleButtonState()}))}))}enableValidation(){this._form.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}};class s{constructor(e){this._popupElement=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this),this._closeClick=this._closeClick.bind(this)}open(){this._popupElement.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscClose),this._popupElement.addEventListener("mousedown",this._closeClick)}close(){this._popupElement.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscClose),this._popupElement.removeEventListener("mousedown",this._closeClick)}_handleEscClose(e){"Escape"===e.key&&this.close()}_closeClick(e){(e.target.classList.contains("modal_opened")||e.target.classList.contains("modal__close"))&&this.close()}setEventListeners(){this._popupElement.addEventListener("click",this._closeClick)}}class r extends s{constructor(e,t){super(e),this._popupForm=this._popupElement.querySelector(".modal__form"),this._handleSubmit=t,this._submitButton=this._popupForm.querySelector(".modal__button")}_getInputValues(){const e=Array.from(this._popupForm.querySelectorAll(".modal__input")),t={};return e.forEach((e=>{t[e.name]=e.value})),t}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmit(this._getInputValues())}))}close(){super.close(),this._popupForm.reset()}renderLoading(e){this._submitButton.textContent=e?"Saving...":"Save"}}const n=document.querySelector("#profile-edit-modal"),o=document.querySelector("#profile-edit-button"),i=(n.querySelector(".modal__close"),n.querySelector(".modal__form")),a=document.querySelector("#profile-title-input"),l=document.querySelector("#profile-description-input"),d=(document.querySelector("#profile-add-modal"),document.querySelector("#profile-add-button")),c=document.querySelector("#modal-add-form"),h=(document.querySelector("#preview-image-modal").querySelector(".modal__close"),document.querySelector("#edit-avatar-form")),u={form:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__button",inactiveButtonClass:"modal__save-button-inactive",inputErrorClass:"modal__input_type_error",errorClass:"modal__input-error_active"},_=new class{constructor(e){let{nameSelector:t,jobSelector:s,avatarSelector:r}=e;this._nameEl=document.querySelector(t),this._jobEl=document.querySelector(s),this._avatarElement=document.querySelector(r)}getUserInfo(){return{name:this._nameEl.textContent,job:this._jobEl.textContent,avatar:this._avatarELement}}setAvatarInfo(e){this._avatarElement.src=e}setUserInfo(e){let{name:t,job:s}=e;this._nameEl.textContent=t,this._jobEl.textContent=s}}({nameSelector:".profile__title",jobSelector:".profile__description",avatarSelector:".profile__image"}),m=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._headers=s}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error ${e.status}`)}getUserInfo(){return fetch("https://around.nomoreparties.co/v1/cohort-3-en/users/me",{method:"GET",headers:this._headers}).then(this._checkResponse)}getAppInfo(){return Promise.all([this.getUserInfo(),this.initialCards()])}initialCards(){return fetch("https://around.nomoreparties.co/v1/cohort-3-en/cards",{method:"GET",headers:this._headers}).then(this._checkResponse)}editProfile(e){let{name:t,description:s}=e;return fetch("https://around.nomoreparties.co/v1/cohort-3-en/users/me",{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:s})}).then(this._checkResponse)}addNewCard(e){let{name:t,link:s}=e;return fetch("https://around.nomoreparties.co/v1/cohort-3-en/cards",{method:"post",headers:this._headers,body:JSON.stringify({name:t,link:s})}).then(this._checkResponse)}cardLikes(e){return fetch(`https://around.nomoreparties.co/v1/cohort-3-en/cards/likes/${e}`,{method:"PUT",headers:this._headers}).then(this._checkResponse)}deleteCard(e){return fetch(`https://around.nomoreparties.co/v1/cohort-3-en/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}addLike(e){let{_id:t}=e;return fetch(`https://around.nomoreparties.co/v1/cohort-3-en/cards/likes/${t}`,{method:"PUT",headers:this._headers}).then(this._checkResponse)}removeLike(e){let{_id:t}=e;return fetch(`https://around.nomoreparties.co/v1/cohort-3-en/cards/likes/${t}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}updateProfilePicture(e){return fetch("https://around.nomoreparties.co/v1/cohort-3-en/users/me/avatar",{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then(this._checkResponse)}}({baseURL:"https://around.nomoreparties.co/v1/cohort-3-en",headers:{authorization:"d8b9199f-b9d7-4b7f-ad09-c5597d55941e","Content-Type":"application/json"}});let p,v;function E(t){const s=new e({data:t,cardSelector:"#card-template",currentUserId:v,handlePreviewImage:()=>{y.open(t)},handleLikeCard:e=>{e?m.removeLike(t).then((e=>{s.updateLikes(e.likes)})).catch((e=>{console.log(e)})):m.addLike(t).then((e=>{s.updateLikes(e.likes)})).catch((e=>{console.log(e)}))},handleDeleteCard:e=>{!function(e,t){S.open(),S.setSubmitAction((()=>{S.renderLoading(!0),m.deleteCard(t).then((()=>{e.deleteClick(),S.close()})).catch((e=>{console.log(e)})).finally((()=>{S.renderLoading(!1)}))}))}(s,e)}});return s.generateCard()}m.getAppInfo().then((e=>{let[t,s]=e;v=t._id,_.setUserInfo({name:t.name,job:t.about}),_.setAvatarInfo(t.avatar),p=new class{constructor(e,t){let{items:s,renderer:r}=e;this._items=s,this._renderer=r,this._container=document.querySelector(t)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}prependItem(e){this._container.prepend(e)}}({items:s,renderer:e=>{const t=E(e);p.addItem(t)}},".cards__list"),p.renderItems()})).catch((e=>{console.log(e)}));const k=new t(c,u);k.enableValidation();const L=new t(i,u);L.enableValidation();const f=new t(h,u);f.enableValidation();const S=new class extends s{constructor(e){super(e),this._popupForm=this._popupElement.querySelector(".modal__form"),this._confirmButton=document.querySelector("#modal-delete-btn"),this._saveButton=document.querySelector(".modal__button")}setEventListeners(){super.setEventListeners(),document.addEventListener("keydown",this._handleEscClose),this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleDeleteSubmit()}))}renderLoading(e){this._confirmButton.textContent=e?"Saving...":"Yes"}setSubmitAction(e){this._handleDeleteSubmit=e}}("#delete-modal");S.setEventListeners();const b=new r("#profile-edit-modal",(e=>{b.renderLoading(!0),m.editProfile(e).then((()=>{_.setUserInfo({name:e.name,job:e.description}),b.close()})).catch((e=>{console.err(e)})).finally((()=>{b.renderLoading(!1)}))}));b.setEventListeners();const C=new r("#profile-add-modal",(e=>{C.renderLoading(!0),m.addNewCard(e).then((e=>{const t=E(e);p.addItem(t),C.close()})).catch((e=>{console.log(e)})).finally((()=>{C.renderLoading(!1)}))}));C.setEventListeners();const g=new r("#edit-avatar-modal",(e=>{g.renderLoading(!0),m.updateProfilePicture(e).then((e=>{_.setAvatarInfo(e.avatar),g.close()})).catch((e=>{console.log(e)})).finally((()=>{g.renderLoading(!1)}))}));g.setEventListeners(),document.querySelector(".profile__image").addEventListener("click",(()=>{g.open(),f.resetValidation()}));const y=new class extends s{constructor(e){super(e),this._previewImageElement=document.querySelector(".modal__image"),this._previewImageCaption=document.querySelector(".modal__caption")}open(e){this._previewImageCaption.textContent=e.name,this._previewImageElement.alt=e.name,this._previewImageElement.src=e.link,super.open()}}("#preview-image-modal");y.setEventListeners(),o.addEventListener("click",(function(){const{name:e,job:t}=_.getUserInfo();a.value=e,l.value=t,L.resetValidation(),b.open()})),d.addEventListener("click",(()=>{k.resetValidation(),C.open()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEVBQWEsSUs5TUosY0FBNkIzRixFQUN4QzdGLFlBQVk4RixHQUNSZSxNQUFNZixHQUNOckYsS0FBSytNLHFCQUF1QjdMLFNBQVNDLGNBQWMsaUJBQ25EbkIsS0FBS2dOLHFCQUF1QjlMLFNBQVNDLGNBQWMsa0JBQ3ZELENBRUF1RSxLQUFLakcsR0FDRE8sS0FBS2dOLHFCQUFxQm5MLFlBQWNwQyxFQUFLUyxLQUM3Q0YsS0FBSytNLHFCQUFxQmpLLElBQU1yRCxFQUFLUyxLQUNyQ0YsS0FBSytNLHFCQUFxQmxLLElBQU1wRCxFQUFLVyxLQUNyQ2dHLE1BQU1WLE1BQ1YsR0xrTWtDLHdCQUN0Q3FGLEVBQVc5RSxvQkFTWGdCLEVBQWtCeEUsaUJBQWlCLFNBUG5DLFdBQ0UsTUFBTSxLQUFFdkMsRUFBSSxJQUFFK0gsR0FBUVIsRUFBV08sY0FDakNiLEVBQWVQLE1BQVExRyxFQUN2QmtILEVBQXFCUixNQUFRcUIsRUFDN0JxRSxFQUFxQi9ILGtCQUNyQnFJLEVBQWNsSCxNQUNoQixJQUVBMkIsRUFBYTVFLGlCQUFpQixTQUFTLEtBQ3JDMkosRUFBaUI3SCxrQkFDakJzSSxFQUFhbkgsTUFBTSxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL3V0aWxzL0FwaS5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9TZWN0aW9uLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aENvbmZpcm0uanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FyZCB7XG4gIGNvbnN0cnVjdG9yKHtcbiAgICBkYXRhLFxuICAgIGNhcmRTZWxlY3RvcixcbiAgICBoYW5kbGVQcmV2aWV3SW1hZ2UsXG4gICAgaGFuZGxlTGlrZUNhcmQsXG4gICAgY3VycmVudFVzZXJJZCxcbiAgICBoYW5kbGVEZWxldGVDYXJkLFxuICAgIG93bmVyLFxuICB9KSB7XG4gICAgdGhpcy5fbmFtZSA9IGRhdGEubmFtZTtcbiAgICB0aGlzLl9saW5rID0gZGF0YS5saW5rO1xuICAgIHRoaXMuX2xpa2VzID0gZGF0YS5saWtlcztcbiAgICB0aGlzLl9pZCA9IGRhdGEuX2lkO1xuXG4gICAgdGhpcy5fY2FyZFNlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xuICAgIHRoaXMuX2hhbmRsZUltYWdlQ2xpY2sgPSBoYW5kbGVQcmV2aWV3SW1hZ2U7XG4gICAgdGhpcy5faGFuZGxlTGlrZUNhcmQgPSBoYW5kbGVMaWtlQ2FyZDtcbiAgICB0aGlzLl9jdXJyZW50VXNlcklkID0gY3VycmVudFVzZXJJZDtcbiAgICB0aGlzLl9vd25lciA9IGRhdGEub3duZXIuX2lkO1xuICAgIHRoaXMuX2hhbmRsZURlbGV0ZUNhcmQgPSBoYW5kbGVEZWxldGVDYXJkO1xuICAgIGNvbnNvbGUubG9nKHRoaXMuX293bmVyKTtcbiAgfVxuXG4gIF9nZXRUZW1wbGF0ZSgpIHtcbiAgICBjb25zdCBjYXJkRWxlbWVudCA9IGRvY3VtZW50XG4gICAgICAucXVlcnlTZWxlY3Rvcih0aGlzLl9jYXJkU2VsZWN0b3IpXG4gICAgICAuY29udGVudC5maXJzdEVsZW1lbnRDaGlsZC5jbG9uZU5vZGUodHJ1ZSk7XG4gICAgdGhpcy5fY2FyZExpa2VzID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcignLmNhcmRfX2xpa2VzLWFtb3VudCcpO1xuICAgIHJldHVybiBjYXJkRWxlbWVudDtcbiAgfVxuICBcblxuICBkZWxldGVDbGljaygpIHtcbiAgICB0aGlzLl9lbGVtZW50LnJlbW92ZSgpO1xuICB9XG5cbiAgdXBkYXRlTGlrZXMobGlrZXMpIHtcbiAgICB0aGlzLl9saWtlcyA9IGxpa2VzO1xuICAgIHRoaXMucmVuZGVyTGlrZXMoKTtcbiAgfVxuXG4gIHJlbmRlckxpa2VzKCkge1xuICAgIHRoaXMuX2NhcmRMaWtlcy50ZXh0Q29udGVudCA9IHRoaXMuX2xpa2VzLmxlbmd0aDtcbiAgICBjb25zdCBpc0xpa2VkID0gdGhpcy5pc0xpa2VkKCk7XG4gICAgaWYgKGlzTGlrZWQpIHtcbiAgICAgIHRoaXMubGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmxpa2VCdXR0b24uY2xhc3NMaXN0LnJlbW92ZShcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcbiAgICB9XG4gIH1cblxuICBpc0xpa2VkKCkge1xuICAgIHJldHVybiB0aGlzLl9saWtlcy5zb21lKChsaWtlKSA9PiBsaWtlLl9pZCA9PT0gdGhpcy5fY3VycmVudFVzZXJJZCk7XG4gIH1cblxuICBfY2hlY2tJZEZvckRlbGV0ZSgpIHtcbiAgICBpZiAodGhpcy5fb3duZXIgIT09IHRoaXMuX2N1cnJlbnRVc2VySWQpIHtcbiAgICAgIHRoaXMucmVtb3ZlVHJhc2goKTtcbiAgICB9XG4gIH1cblxuICByZW1vdmVUcmFzaCgpIHtcbiAgICB0aGlzLmNhcmRUcmFzaEJ1dHRvbi5yZW1vdmUoKTtcbiAgfVxuXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLmxpa2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XG4gICAgICB0aGlzLl9oYW5kbGVMaWtlQ2FyZCh0aGlzLmlzTGlrZWQoKSlcbiAgICApO1xuICAgIHRoaXMuY2FyZFRyYXNoQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLl9oYW5kbGVEZWxldGVDYXJkKHRoaXMuX2lkKTtcbiAgICB9KTtcbiAgICB0aGlzLmNhcmRJbWFnZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5faGFuZGxlSW1hZ2VDbGljaygpO1xuICAgIH0pO1xuICB9XG5cbiAgZ2VuZXJhdGVDYXJkKCkge1xuICAgIHRoaXMuX2VsZW1lbnQgPSB0aGlzLl9nZXRUZW1wbGF0ZSgpO1xuICAgIHRoaXMubGlrZUJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ1dHRvblwiKTtcbiAgICB0aGlzLmNhcmRUcmFzaEJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnV0dG9uXCIpO1xuICAgIHRoaXMuY2FyZEltYWdlID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuICAgIGNvbnN0IGNhcmRUaXRsZSA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKTtcbiAgICB0aGlzLl9jYXJkTGlrZXMgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19saWtlLWFtb3VudCcpOyBcbiAgICB0aGlzLmNhcmRJbWFnZS5zcmMgPSB0aGlzLl9saW5rO1xuICAgIHRoaXMuY2FyZEltYWdlLmFsdCA9IHRoaXMuX25hbWU7XG4gICAgY2FyZFRpdGxlLnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuX2NoZWNrSWRGb3JEZWxldGUoKTtcbiAgICByZXR1cm4gdGhpcy5fZWxlbWVudDtcbiAgfVxufSIsImNsYXNzIEZvcm1WYWxpZGF0b3Ige1xuICBjb25zdHJ1Y3Rvcihmb3JtRWxlbWVudCwgc2V0dGluZ3MpIHtcbiAgICB0aGlzLl9pbnB1dFNlbGVjdG9yID0gc2V0dGluZ3MuaW5wdXRTZWxlY3RvcjtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3RvciA9IHNldHRpbmdzLnN1Ym1pdEJ1dHRvblNlbGVjdG9yO1xuICAgIHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MgPSBzZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzO1xuICAgIHRoaXMuX2lucHV0RXJyb3JDbGFzcyA9IHNldHRpbmdzLmlucHV0RXJyb3JDbGFzcztcbiAgICB0aGlzLl9lcnJvckNsYXNzID0gc2V0dGluZ3MuZXJyb3JDbGFzcztcbiAgICB0aGlzLl9mb3JtID0gZm9ybUVsZW1lbnQ7XG4gICAgdGhpcy5fYnV0dG9uRWxlbWVudCA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3Rvcih0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG5cbiAgICB0aGlzLl9pbnB1dEVsZW1lbnRzID0gQXJyYXkuZnJvbSh0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5faW5wdXRTZWxlY3RvcikpO1xuICB9XG5cbiAgX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xuICAgIGNvbnN0IGVycm9yTWVzc2FnZUVsZW0gPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xuICAgIGVycm9yTWVzc2FnZUVsZW0udGV4dENvbnRlbnQgPSBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2U7XG4gICAgZXJyb3JNZXNzYWdlRWxlbS5jbGFzc0xpc3QuYWRkKHRoaXMuX2Vycm9yQ2xhc3MpO1xuICB9XG5cbiAgX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xuICAgIGNvbnN0IGVycm9yTWVzc2FnZUVsZW0gPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xuICAgIGVycm9yTWVzc2FnZUVsZW0udGV4dENvbnRlbnQgPSBcIlwiO1xuICAgIGVycm9yTWVzc2FnZUVsZW0uY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9lcnJvckNsYXNzKTtcbiAgfVxuXG4gIHJlc2V0VmFsaWRhdGlvbigpIHtcbiAgICB0aGlzLl9pbnB1dEVsZW1lbnRzLmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcbiAgICB9KTtcblxuICAgIHRoaXMudG9nZ2xlQnV0dG9uU3RhdGUoKTtcbiAgfVxuXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKCkge1xuICAgIGlmICh0aGlzLl9oYXNJbnZhbGlkSW5wdXQoKSkge1xuICAgICAgdGhpcy5fZGlzYWJsZUJ1dHRvbigpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9lbmFibGVCdXR0b24oKTtcbiAgICB9XG4gIH1cblxuICBfaGFzSW52YWxpZElucHV0KCkge1xuICAgIHJldHVybiB0aGlzLl9pbnB1dEVsZW1lbnRzLnNvbWUoKGlucHV0RWxlbWVudCkgPT4ge1xuICAgICAgcmV0dXJuICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQ7XG4gICAgfSk7XG4gIH1cblxuICBfY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCkge1xuICAgIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgICB0aGlzLl9zaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xuICAgIH1cbiAgfVxuXG4gIF9kaXNhYmxlQnV0dG9uKCkge1xuICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICB0aGlzLl9idXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbiAgfVxuXG4gIF9lbmFibGVCdXR0b24oKSB7XG4gICAgdGhpcy5fYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgfVxuXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9pbnB1dEVsZW1lbnRzLmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsZW1lbnQpO1xuICAgICAgICB0aGlzLnRvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XG4gICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSk7XG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBGb3JtVmFsaWRhdG9yO1xuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwb3B1cFNlbGVjdG9yKTtcbiAgICB0aGlzLl9oYW5kbGVFc2NDbG9zZSA9IHRoaXMuX2hhbmRsZUVzY0Nsb3NlLmJpbmQodGhpcyk7XG4gICAgdGhpcy5fY2xvc2VDbGljayA9IHRoaXMuX2Nsb3NlQ2xpY2suYmluZCh0aGlzKTtcbiAgfVxuXG4gIG9wZW4oKSB7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ21vZGFsX29wZW5lZCcpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRoaXMuX2Nsb3NlQ2xpY2spO1xuICB9XG5cbiAgY2xvc2UoKSB7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ21vZGFsX29wZW5lZCcpO1xuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRoaXMuX2Nsb3NlQ2xpY2spO1xuICB9XG5cbiAgX2hhbmRsZUVzY0Nsb3NlKGV2ZW50KSB7XG4gICAgaWYgKGV2ZW50LmtleSA9PT0gJ0VzY2FwZScpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICBfY2xvc2VDbGljayhlKSB7XG4gICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfb3BlbmVkJykgfHwgZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9fY2xvc2UnKSkge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH1cbiAgfVxuXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuX2Nsb3NlQ2xpY2spO1xuICB9XG59XG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3RvciwgaGFuZGxlU3VibWl0KSB7XG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG4gICAgdGhpcy5fcG9wdXBGb3JtID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG4gICAgdGhpcy5faGFuZGxlU3VibWl0ID0gaGFuZGxlU3VibWl0O1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbiA9IHRoaXMuX3BvcHVwRm9ybS5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19idXR0b25cIik7XG4gIH1cblxuICBfZ2V0SW5wdXRWYWx1ZXMoKSB7XG4gICAgY29uc3QgaW5wdXRzID0gQXJyYXkuZnJvbSh0aGlzLl9wb3B1cEZvcm0ucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbF9faW5wdXRcIikpO1xuICAgIGNvbnN0IGlucHV0VmFsdWVzID0ge307XG4gICAgaW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICBpbnB1dFZhbHVlc1tpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO1xuICAgIH0pO1xuICAgIHJldHVybiBpbnB1dFZhbHVlcztcbiAgfVxuXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgdGhpcy5fcG9wdXBGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuX2hhbmRsZVN1Ym1pdCh0aGlzLl9nZXRJbnB1dFZhbHVlcygpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIHN1cGVyLmNsb3NlKCk7XG4gICAgdGhpcy5fcG9wdXBGb3JtLnJlc2V0KCk7XG4gIH1cblxuICByZW5kZXJMb2FkaW5nKGlzTG9hZGluZykge1xuICAgIGlmIChpc0xvYWRpbmcpIHtcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU2F2ZVwiO1xuICAgIH1cbiAgfVxufVxuIiwiIGNvbnN0IGluaXRpYWxDYXJkcyA9IFtcbiAge1xuICAgIG5hbWU6IFwiWW9zZW1pdGUgVmFsbGV5XCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L3lvc2VtaXRlLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJMYWtlIExvdWlzZVwiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC9sYWtlLWxvdWlzZS5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiQmFsZCBNb3VudGFpbnNcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvYXJvdW5kLXByb2plY3QvYmFsZC1tb3VudGFpbnMuanBnXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIkxhdGVtYXJcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvYXJvdW5kLXByb2plY3QvbGF0ZW1hci5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiVmFub2lzZSBOYXRpb25hbCBQYXJrXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L3Zhbm9pc2UuanBnXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIkxhZ28gZGkgQnJhaWVzXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L2xhZ28uanBnIFwiLFxuICB9LFxuXTtcblxuIGNvbnN0IHByb2ZpbGVFZGl0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcHJvZmlsZS1lZGl0LW1vZGFsJyk7XG4gY29uc3QgcHJvZmlsZUVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcHJvZmlsZS1lZGl0LWJ1dHRvbicpO1xuIGNvbnN0IHByb2ZpbGVNb2RhbENsb3NlQnRuID0gcHJvZmlsZUVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gY29uc3QgcHJvZmlsZUVkaXRGb3JtID0gcHJvZmlsZUVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Zvcm0nKTtcbiBjb25zdCBwcm9maWxlVGl0bGVFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwcm9maWxlLXRpdGxlLWlucHV0Jyk7XG4gY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcHJvZmlsZS1kZXNjcmlwdGlvbi1pbnB1dCcpO1xuIGNvbnN0IGNhcmRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwcm9maWxlLWFkZC1tb2RhbCcpO1xuIGNvbnN0IGNhcmRNb2RhbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwcm9maWxlLWFkZC1idXR0b24nKVxuIGNvbnN0IGNhcmRNb2RhbEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbW9kYWwtYWRkLWZvcm0nKTtcbiBjb25zdCBwcmV2aWV3SW1hZ2VNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwcmV2aWV3LWltYWdlLW1vZGFsJyk7XG4gY29uc3QgcHJldmlld0ltYWdlTW9kYWxDbG9zZUJ0biA9IHByZXZpZXdJbWFnZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcbiBjb25zdCBhdmF0YXJGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2VkaXQtYXZhdGFyLWZvcm0nKTtcblxuIGNvbnN0IHNldHRpbmdzID0ge1xuICBmb3JtOiAnLm1vZGFsX19mb3JtJyxcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fYnV0dG9uXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3NhdmUtYnV0dG9uLWluYWN0aXZlXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dC1lcnJvcl9hY3RpdmVcIixcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBoYW5kbGVPdmVybGF5Q2xvc2UoZSkge1xuICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxcIikpIHtcbiAgICBjbG9zZU1vZGFsKGUudGFyZ2V0KTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlRXNjVXAoZSkge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgY29uc3Qgb3BlblBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9vcGVuZWRcIik7XG4gICAgY2xvc2VNb2RhbChvcGVuUG9wdXApO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBvcGVuTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsX29wZW5lZFwiKTtcbiAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBoYW5kbGVPdmVybGF5Q2xvc2UpO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgaGFuZGxlRXNjVXApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2xvc2VNb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfb3BlbmVkXCIpO1xuICBtb2RhbC5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGhhbmRsZU92ZXJsYXlDbG9zZSk7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCBoYW5kbGVFc2NVcCk7XG59XG5cbmV4cG9ydCB7XG4gIHNldHRpbmdzLFxuICBwcmV2aWV3SW1hZ2VNb2RhbENsb3NlQnRuLFxuICBwcmV2aWV3SW1hZ2VNb2RhbCxcbiAgcHJvZmlsZU1vZGFsQ2xvc2VCdG4sXG4gIHByb2ZpbGVEZXNjcmlwdGlvbkVsLFxuICBwcm9maWxlVGl0bGVFbCxcbiAgcHJvZmlsZUVkaXRGb3JtLFxuICBjYXJkTW9kYWwsXG4gIGNhcmRNb2RhbEJ0bixcbiAgcHJvZmlsZUVkaXRCdXR0b24sXG4gIGNhcmRNb2RhbEZvcm0gLFxuICBhdmF0YXJGb3JtLFxufSIsImltcG9ydCAnLi9pbmRleC5jc3MnO1xuaW1wb3J0IENhcmQgZnJvbSAnLi4vY29tcG9uZW50cy9DYXJkLmpzJztcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xuaW1wb3J0IFBvcHVwV2l0aENvbmZpcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoQ29uZmlybS5qc1wiO1xuaW1wb3J0IFNlY3Rpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvU2VjdGlvbi5qc1wiO1xuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCI7XG5pbXBvcnQge1xuICBzZXR0aW5ncyxcbiAgcHJldmlld0ltYWdlTW9kYWxDbG9zZUJ0bixcbiAgcHJldmlld0ltYWdlTW9kYWwsXG4gIHByb2ZpbGVNb2RhbENsb3NlQnRuLFxuICBwcm9maWxlRGVzY3JpcHRpb25FbCxcbiAgcHJvZmlsZVRpdGxlRWwsXG4gIHByb2ZpbGVFZGl0Rm9ybSxcbiAgY2FyZE1vZGFsLFxuICBjYXJkTW9kYWxCdG4sXG4gIHByb2ZpbGVFZGl0QnV0dG9uLFxuICBjYXJkTW9kYWxGb3JtLFxuICBhdmF0YXJGb3JtLFxufSBmcm9tICcuLi91dGlscy9jb25zdGFudHMnO1xuaW1wb3J0IEFwaSBmcm9tICcuLi91dGlscy9BcGknO1xuXG5jb25zdCB1c2VySW5mb0VsID0gbmV3IFVzZXJJbmZvKHtcbiAgbmFtZVNlbGVjdG9yOiBcIi5wcm9maWxlX190aXRsZVwiLFxuICBqb2JTZWxlY3RvcjogXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIixcbiAgYXZhdGFyU2VsZWN0b3I6IFwiLnByb2ZpbGVfX2ltYWdlXCIsXG59KTtcblxuLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cbi8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFwaSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcbiAgYmFzZVVSTDogXCJodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2NvaG9ydC0zLWVuXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcImQ4YjkxOTlmLWI5ZDctNGI3Zi1hZDA5LWM1NTk3ZDU1OTQxZVwiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5cbmxldCBzZWN0aW9uRWw7XG5sZXQgY3VycmVudFVzZXJJZDtcblxuYXBpXG4gIC5nZXRBcHBJbmZvKClcbiAgLnRoZW4oKFt1c2VyRGF0YSwgY2FyZERhdGFdKSA9PiB7XG4gICAgY3VycmVudFVzZXJJZCA9IHVzZXJEYXRhLl9pZDtcbiAgICB1c2VySW5mb0VsLnNldFVzZXJJbmZvKHsgbmFtZTogdXNlckRhdGEubmFtZSwgam9iOiB1c2VyRGF0YS5hYm91dCB9KTtcbiAgICB1c2VySW5mb0VsLnNldEF2YXRhckluZm8odXNlckRhdGEuYXZhdGFyKTtcbiAgICBzZWN0aW9uRWwgPSBuZXcgU2VjdGlvbihcbiAgICAgIHtcbiAgICAgICAgaXRlbXM6IGNhcmREYXRhLFxuXG4gICAgICAgIHJlbmRlcmVyOiAoZGF0YSkgPT4ge1xuICAgICAgICAgIGNvbnN0IGNhcmQgPSBjcmVhdGVDYXJkKGRhdGEpO1xuICAgICAgICAgIHNlY3Rpb25FbC5hZGRJdGVtKGNhcmQpO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIFwiLmNhcmRzX19saXN0XCJcbiAgICApO1xuICAgIHNlY3Rpb25FbC5yZW5kZXJJdGVtcygpO1xuICB9KVxuICAuY2F0Y2goKGVycikgPT4ge1xuICAgIGNvbnNvbGUubG9nKGVycik7XG4gIH0pO1xuXG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYXJkICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIGRlbGV0ZUNhcmQoY2FyZCwgY2FyZElkKSB7XG4gIGRlbGV0ZU1vZGFsLm9wZW4oKTtcbiAgZGVsZXRlTW9kYWwuc2V0U3VibWl0QWN0aW9uKCgpID0+IHtcbiAgICBkZWxldGVNb2RhbC5yZW5kZXJMb2FkaW5nKHRydWUpO1xuICAgIGFwaVxuICAgICAgLmRlbGV0ZUNhcmQoY2FyZElkKVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICBjYXJkLmRlbGV0ZUNsaWNrKCk7XG4gICAgICAgIGRlbGV0ZU1vZGFsLmNsb3NlKCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgIH0pXG4gICAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICAgIGRlbGV0ZU1vZGFsLnJlbmRlckxvYWRpbmcoZmFsc2UpO1xuICAgICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVDYXJkKGRhdGEpIHtcbiAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKHtcbiAgICBkYXRhLFxuICAgIGNhcmRTZWxlY3RvcjogXCIjY2FyZC10ZW1wbGF0ZVwiLFxuICAgIGN1cnJlbnRVc2VySWQsXG4gICAgaGFuZGxlUHJldmlld0ltYWdlOiAoKSA9PiB7XG4gICAgICBpbWFnZVBvcHVwLm9wZW4oZGF0YSk7XG4gICAgfSxcbiAgICBoYW5kbGVMaWtlQ2FyZDogKHNob3VsZFJlbW92ZUxpa2UpID0+IHtcbiAgICAgIGlmIChzaG91bGRSZW1vdmVMaWtlKSB7XG4gICAgICAgIGFwaVxuICAgICAgICAgIC5yZW1vdmVMaWtlKGRhdGEpXG4gICAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGNhcmQudXBkYXRlTGlrZXMoZGF0YS5saWtlcyk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFwaVxuICAgICAgICAgIC5hZGRMaWtlKGRhdGEpXG4gICAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGNhcmQudXBkYXRlTGlrZXMoZGF0YS5saWtlcyk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGhhbmRsZURlbGV0ZUNhcmQ6IChjYXJkSWQpID0+IHtcbiAgICAgIGRlbGV0ZUNhcmQoY2FyZCwgY2FyZElkKTtcbiAgICB9LFxuICB9KTtcbiAgcmV0dXJuIGNhcmQuZ2VuZXJhdGVDYXJkKCk7XG59XG5cbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG4vKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGb3JtIFZhbGlkYXRvciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29uc3QgYWRkRm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGNhcmRNb2RhbEZvcm0sIHNldHRpbmdzKTtcbmFkZEZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG5jb25zdCBwcm9maWxlRm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKHByb2ZpbGVFZGl0Rm9ybSwgc2V0dGluZ3MpO1xucHJvZmlsZUZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG5jb25zdCBhdmF0YXJGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoYXZhdGFyRm9ybSwgc2V0dGluZ3MpO1xuYXZhdGFyRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5cbmNvbnN0IGRlbGV0ZU1vZGFsID0gbmV3IFBvcHVwV2l0aENvbmZpcm0oJyNkZWxldGUtbW9kYWwnKTtcbmRlbGV0ZU1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmNvbnN0IGVkaXRGb3JtTW9kYWwgPSBuZXcgUG9wdXBXaXRoRm9ybSgnI3Byb2ZpbGUtZWRpdC1tb2RhbCcsIChpbnB1dFZhbHVlcykgPT4ge1xuICBlZGl0Rm9ybU1vZGFsLnJlbmRlckxvYWRpbmcodHJ1ZSk7XG4gIGFwaVxuICAgIC5lZGl0UHJvZmlsZShpbnB1dFZhbHVlcylcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICB1c2VySW5mb0VsLnNldFVzZXJJbmZvKHtcbiAgICAgICAgbmFtZTogaW5wdXRWYWx1ZXMubmFtZSxcbiAgICAgICAgam9iOiBpbnB1dFZhbHVlcy5kZXNjcmlwdGlvbixcbiAgICAgIH0pO1xuICAgICAgZWRpdEZvcm1Nb2RhbC5jbG9zZSgpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyKGVycik7XG4gICAgfSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBlZGl0Rm9ybU1vZGFsLnJlbmRlckxvYWRpbmcoZmFsc2UpO1xuICAgIH0pO1xufSk7XG5lZGl0Rm9ybU1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmNvbnN0IGFkZEZvcm1Nb2RhbCA9IG5ldyBQb3B1cFdpdGhGb3JtKCcjcHJvZmlsZS1hZGQtbW9kYWwnLCAoaW5wdXRWYWx1ZXMpID0+IHtcbiAgYWRkRm9ybU1vZGFsLnJlbmRlckxvYWRpbmcodHJ1ZSk7XG4gIGFwaVxuICAgIC5hZGROZXdDYXJkKGlucHV0VmFsdWVzKVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBjb25zdCBjYXJkID0gY3JlYXRlQ2FyZChkYXRhKTtcbiAgICAgIHNlY3Rpb25FbC5hZGRJdGVtKGNhcmQpO1xuICAgICAgYWRkRm9ybU1vZGFsLmNsb3NlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIGFkZEZvcm1Nb2RhbC5yZW5kZXJMb2FkaW5nKGZhbHNlKTtcbiAgICB9KTtcbn0pO1xuYWRkRm9ybU1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmNvbnN0IHVwZGF0ZVByb2ZpbGVGb3JtID0gbmV3IFBvcHVwV2l0aEZvcm0oJyNlZGl0LWF2YXRhci1tb2RhbCcsIChpbnB1dFZhbHVlcykgPT4ge1xuICB1cGRhdGVQcm9maWxlRm9ybS5yZW5kZXJMb2FkaW5nKHRydWUpO1xuICBhcGlcbiAgICAudXBkYXRlUHJvZmlsZVBpY3R1cmUoaW5wdXRWYWx1ZXMpXG4gICAgLnRoZW4oKHZhbHVlKSA9PiB7XG4gICAgICB1c2VySW5mb0VsLnNldEF2YXRhckluZm8odmFsdWUuYXZhdGFyKTtcbiAgICAgIHVwZGF0ZVByb2ZpbGVGb3JtLmNsb3NlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHVwZGF0ZVByb2ZpbGVGb3JtLnJlbmRlckxvYWRpbmcoZmFsc2UpO1xuICAgIH0pO1xufSk7XG51cGRhdGVQcm9maWxlRm9ybS5zZXRFdmVudExpc3RlbmVycygpO1xuXG5jb25zdCBwcm9maWxlRWRpdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9faW1hZ2VcIik7XG5wcm9maWxlRWRpdC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICB1cGRhdGVQcm9maWxlRm9ybS5vcGVuKCk7XG4gIGF2YXRhckZvcm1WYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uKCk7XG59KTtcblxuLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cbi8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3B1cHMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb25zdCBpbWFnZVBvcHVwID0gbmV3IFBvcHVwV2l0aEltYWdlKCcjcHJldmlldy1pbWFnZS1tb2RhbCcpO1xuaW1hZ2VQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuXG5mdW5jdGlvbiBvcGVuUHJvZmlsZU1vZGFsKCkge1xuICBjb25zdCB7IG5hbWUsIGpvYiB9ID0gdXNlckluZm9FbC5nZXRVc2VySW5mbygpO1xuICBwcm9maWxlVGl0bGVFbC52YWx1ZSA9IG5hbWU7XG4gIHByb2ZpbGVEZXNjcmlwdGlvbkVsLnZhbHVlID0gam9iO1xuICBwcm9maWxlRm9ybVZhbGlkYXRvci5yZXNldFZhbGlkYXRpb24oKTtcbiAgZWRpdEZvcm1Nb2RhbC5vcGVuKCk7XG59XG5wcm9maWxlRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgb3BlblByb2ZpbGVNb2RhbCk7XG5jYXJkTW9kYWxCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgYWRkRm9ybVZhbGlkYXRvci5yZXNldFZhbGlkYXRpb24oKTtcbiAgYWRkRm9ybU1vZGFsLm9wZW4oKTtcbn0pO1xuXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBVc2VySW5mbyB7XG4gIGNvbnN0cnVjdG9yKHsgbmFtZVNlbGVjdG9yLCBqb2JTZWxlY3RvciwgYXZhdGFyU2VsZWN0b3IgfSkge1xuICAgIHRoaXMuX25hbWVFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IobmFtZVNlbGVjdG9yKTtcbiAgICB0aGlzLl9qb2JFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioam9iU2VsZWN0b3IpO1xuICAgIHRoaXMuX2F2YXRhckVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGF2YXRhclNlbGVjdG9yKTtcbiAgfVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiB0aGlzLl9uYW1lRWwudGV4dENvbnRlbnQsXG4gICAgICBqb2I6IHRoaXMuX2pvYkVsLnRleHRDb250ZW50LFxuICAgICAgYXZhdGFyOiB0aGlzLl9hdmF0YXJFTGVtZW50LFxuICAgIH07XG4gIH1cblxuICBzZXRBdmF0YXJJbmZvKGF2YXRhcikge1xuICAgIHRoaXMuX2F2YXRhckVsZW1lbnQuc3JjID0gYXZhdGFyO1xuICB9XG5cbiAgc2V0VXNlckluZm8oeyBuYW1lLCBqb2IgfSkge1xuICAgIHRoaXMuX25hbWVFbC50ZXh0Q29udGVudCA9IG5hbWU7XG4gICAgdGhpcy5fam9iRWwudGV4dENvbnRlbnQgPSBqb2I7XG4gIH1cbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBBcGkge1xuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xuICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xuICAgIHRoaXMuX2hlYWRlcnMgPSBoZWFkZXJzO1xuICB9XG5cbiAgX2NoZWNrUmVzcG9uc2UocmVzKSB7XG4gICAgaWYgKHJlcy5vaykge1xuICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgfVxuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3IgJHtyZXMuc3RhdHVzfWApO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIGZldGNoKGBodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2NvaG9ydC0zLWVuL3VzZXJzL21lYCwge1xuICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgZ2V0QXBwSW5mbygpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0VXNlckluZm8oKSwgdGhpcy5pbml0aWFsQ2FyZHMoKV0pO1xuICB9XG5cbiAgaW5pdGlhbENhcmRzKCkge1xuICAgIHJldHVybiBmZXRjaChgaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9jb2hvcnQtMy1lbi9jYXJkc2AsIHtcbiAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGVkaXRQcm9maWxlKHsgbmFtZSwgZGVzY3JpcHRpb24gfSkge1xuICAgIHJldHVybiBmZXRjaChgaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9jb2hvcnQtMy1lbi91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgYWJvdXQ6IGRlc2NyaXB0aW9uLFxuICAgICAgfSksXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGFkZE5ld0NhcmQoeyBuYW1lLCBsaW5rIH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYGh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvY29ob3J0LTMtZW4vY2FyZHNgLCB7XG4gICAgICBtZXRob2Q6IFwicG9zdFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgbGluayxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBjYXJkTGlrZXMoY2FyZElkKSB7XG4gICAgcmV0dXJuIGZldGNoKGBodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2NvaG9ydC0zLWVuL2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJQVVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGRlbGV0ZUNhcmQoY2FyZElEKSB7XG4gICAgcmV0dXJuIGZldGNoKGBodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2NvaG9ydC0zLWVuL2NhcmRzLyR7Y2FyZElEfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGFkZExpa2UoeyBfaWQgfSkge1xuICAgIHJldHVybiBmZXRjaChgaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9jb2hvcnQtMy1lbi9jYXJkcy9saWtlcy8ke19pZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiUFVUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICByZW1vdmVMaWtlKHsgX2lkIH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYGh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvY29ob3J0LTMtZW4vY2FyZHMvbGlrZXMvJHtfaWR9YCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgdXBkYXRlUHJvZmlsZVBpY3R1cmUoYXZhdGFyKSB7XG4gICAgcmV0dXJuIGZldGNoKGBodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2NvaG9ydC0zLWVuL3VzZXJzL21lL2F2YXRhcmAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGF2YXRhciksXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxufSIsImNsYXNzIFNlY3Rpb24ge1xuICBjb25zdHJ1Y3Rvcih7IGl0ZW1zLCByZW5kZXJlciB9LCBjb250YWluZXJTZWxlY3Rvcikge1xuICAgIHRoaXMuX2l0ZW1zID0gaXRlbXM7XG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcbiAgfVxuXG4gIHJlbmRlckl0ZW1zKCkge1xuICAgIHRoaXMuX2l0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgIHRoaXMuX3JlbmRlcmVyKGl0ZW0pO1xuICAgIH0pO1xuICB9XG5cbiAgYWRkSXRlbShlbGVtZW50KSB7XG4gICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoZWxlbWVudCk7XG4gIH1cbiAgXG4gIHByZXBlbmRJdGVtKGVsZW1lbnQpIHtcbiAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChlbGVtZW50KTtcbiAgfVxufVxuZXhwb3J0IGRlZmF1bHQgU2VjdGlvbjsiLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoQ29uZmlybSBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xuICAgIHRoaXMuX3BvcHVwRm9ybSA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuICAgIHRoaXMuX2NvbmZpcm1CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21vZGFsLWRlbGV0ZS1idG5cIik7XG4gICAgdGhpcy5fc2F2ZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2J1dHRvblwiKTtcbiAgfVxuXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xuICAgIHRoaXMuX3BvcHVwRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB0aGlzLl9oYW5kbGVEZWxldGVTdWJtaXQoKTtcbiAgICB9KTtcbiAgfVxuXG4gIHJlbmRlckxvYWRpbmcoaXNMb2FkaW5nKSB7XG4gICAgaWYgKGlzTG9hZGluZykge1xuICAgICAgdGhpcy5fY29uZmlybUJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2NvbmZpcm1CdXR0b24udGV4dENvbnRlbnQgPSBcIlllc1wiO1xuICAgIH1cbiAgfVxuXG4gIHNldFN1Ym1pdEFjdGlvbihhY3Rpb24pIHtcbiAgICB0aGlzLl9oYW5kbGVEZWxldGVTdWJtaXQgPSBhY3Rpb247XG4gIH0gIFxufVxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXB7XG4gICAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xuICAgICAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcbiAgICAgICAgdGhpcy5fcHJldmlld0ltYWdlRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9faW1hZ2UnKTtcbiAgICAgICAgdGhpcy5fcHJldmlld0ltYWdlQ2FwdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2FwdGlvbicpO1xuICAgIH1cblxuICAgIG9wZW4oZGF0YSkge1xuICAgICAgICB0aGlzLl9wcmV2aWV3SW1hZ2VDYXB0aW9uLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICAgICAgICB0aGlzLl9wcmV2aWV3SW1hZ2VFbGVtZW50LmFsdCA9IGRhdGEubmFtZTtcbiAgICAgICAgdGhpcy5fcHJldmlld0ltYWdlRWxlbWVudC5zcmMgPSBkYXRhLmxpbms7XG4gICAgICAgIHN1cGVyLm9wZW4oKTtcbiAgICB9XG5cbn0iXSwibmFtZXMiOlsiQ2FyZCIsImNvbnN0cnVjdG9yIiwiX3JlZiIsImRhdGEiLCJjYXJkU2VsZWN0b3IiLCJoYW5kbGVQcmV2aWV3SW1hZ2UiLCJoYW5kbGVMaWtlQ2FyZCIsImN1cnJlbnRVc2VySWQiLCJoYW5kbGVEZWxldGVDYXJkIiwib3duZXIiLCJ0aGlzIiwiX25hbWUiLCJuYW1lIiwiX2xpbmsiLCJsaW5rIiwiX2xpa2VzIiwibGlrZXMiLCJfaWQiLCJfY2FyZFNlbGVjdG9yIiwiX2hhbmRsZUltYWdlQ2xpY2siLCJfaGFuZGxlTGlrZUNhcmQiLCJfY3VycmVudFVzZXJJZCIsIl9vd25lciIsIl9oYW5kbGVEZWxldGVDYXJkIiwiY29uc29sZSIsImxvZyIsIl9nZXRUZW1wbGF0ZSIsImNhcmRFbGVtZW50IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudCIsImZpcnN0RWxlbWVudENoaWxkIiwiY2xvbmVOb2RlIiwiX2NhcmRMaWtlcyIsImRlbGV0ZUNsaWNrIiwiX2VsZW1lbnQiLCJyZW1vdmUiLCJ1cGRhdGVMaWtlcyIsInJlbmRlckxpa2VzIiwidGV4dENvbnRlbnQiLCJsZW5ndGgiLCJpc0xpa2VkIiwibGlrZUJ1dHRvbiIsImNsYXNzTGlzdCIsImFkZCIsInNvbWUiLCJsaWtlIiwiX2NoZWNrSWRGb3JEZWxldGUiLCJyZW1vdmVUcmFzaCIsImNhcmRUcmFzaEJ1dHRvbiIsIl9zZXRFdmVudExpc3RlbmVycyIsImFkZEV2ZW50TGlzdGVuZXIiLCJjYXJkSW1hZ2UiLCJnZW5lcmF0ZUNhcmQiLCJjYXJkVGl0bGUiLCJzcmMiLCJhbHQiLCJmb3JtRWxlbWVudCIsInNldHRpbmdzIiwiX2lucHV0U2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvblNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJfaW5hY3RpdmVCdXR0b25DbGFzcyIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJfaW5wdXRFcnJvckNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiX2Vycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiX2Zvcm0iLCJfYnV0dG9uRWxlbWVudCIsIl9pbnB1dEVsZW1lbnRzIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsIl9zaG93SW5wdXRFcnJvciIsImlucHV0RWxlbWVudCIsImVycm9yTWVzc2FnZUVsZW0iLCJpZCIsInZhbGlkYXRpb25NZXNzYWdlIiwiX2hpZGVJbnB1dEVycm9yIiwicmVzZXRWYWxpZGF0aW9uIiwiZm9yRWFjaCIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiX2hhc0ludmFsaWRJbnB1dCIsIl9kaXNhYmxlQnV0dG9uIiwiX2VuYWJsZUJ1dHRvbiIsInZhbGlkaXR5IiwidmFsaWQiLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwiZGlzYWJsZWQiLCJlbmFibGVWYWxpZGF0aW9uIiwiZSIsInByZXZlbnREZWZhdWx0IiwiUG9wdXAiLCJwb3B1cFNlbGVjdG9yIiwiX3BvcHVwRWxlbWVudCIsIl9oYW5kbGVFc2NDbG9zZSIsImJpbmQiLCJfY2xvc2VDbGljayIsIm9wZW4iLCJjbG9zZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJldmVudCIsImtleSIsInRhcmdldCIsImNvbnRhaW5zIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJQb3B1cFdpdGhGb3JtIiwiaGFuZGxlU3VibWl0Iiwic3VwZXIiLCJfcG9wdXBGb3JtIiwiX2hhbmRsZVN1Ym1pdCIsIl9zdWJtaXRCdXR0b24iLCJfZ2V0SW5wdXRWYWx1ZXMiLCJpbnB1dHMiLCJpbnB1dFZhbHVlcyIsImlucHV0IiwidmFsdWUiLCJyZXNldCIsInJlbmRlckxvYWRpbmciLCJpc0xvYWRpbmciLCJwcm9maWxlRWRpdE1vZGFsIiwicHJvZmlsZUVkaXRCdXR0b24iLCJwcm9maWxlRWRpdEZvcm0iLCJwcm9maWxlVGl0bGVFbCIsInByb2ZpbGVEZXNjcmlwdGlvbkVsIiwiY2FyZE1vZGFsQnRuIiwiY2FyZE1vZGFsRm9ybSIsImF2YXRhckZvcm0iLCJmb3JtIiwidXNlckluZm9FbCIsIm5hbWVTZWxlY3RvciIsImpvYlNlbGVjdG9yIiwiYXZhdGFyU2VsZWN0b3IiLCJfbmFtZUVsIiwiX2pvYkVsIiwiX2F2YXRhckVsZW1lbnQiLCJnZXRVc2VySW5mbyIsImpvYiIsImF2YXRhciIsIl9hdmF0YXJFTGVtZW50Iiwic2V0QXZhdGFySW5mbyIsInNldFVzZXJJbmZvIiwiX3JlZjIiLCJhcGkiLCJiYXNlVXJsIiwiaGVhZGVycyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJfY2hlY2tSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJmZXRjaCIsIm1ldGhvZCIsInRoZW4iLCJnZXRBcHBJbmZvIiwiYWxsIiwiaW5pdGlhbENhcmRzIiwiZWRpdFByb2ZpbGUiLCJkZXNjcmlwdGlvbiIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiYWJvdXQiLCJhZGROZXdDYXJkIiwiX3JlZjMiLCJjYXJkTGlrZXMiLCJjYXJkSWQiLCJkZWxldGVDYXJkIiwiY2FyZElEIiwiYWRkTGlrZSIsIl9yZWY0IiwicmVtb3ZlTGlrZSIsIl9yZWY1IiwidXBkYXRlUHJvZmlsZVBpY3R1cmUiLCJiYXNlVVJMIiwiYXV0aG9yaXphdGlvbiIsInNlY3Rpb25FbCIsImNyZWF0ZUNhcmQiLCJjYXJkIiwiaW1hZ2VQb3B1cCIsInNob3VsZFJlbW92ZUxpa2UiLCJjYXRjaCIsImVyciIsImRlbGV0ZU1vZGFsIiwic2V0U3VibWl0QWN0aW9uIiwiZmluYWxseSIsInVzZXJEYXRhIiwiY2FyZERhdGEiLCJjb250YWluZXJTZWxlY3RvciIsIml0ZW1zIiwicmVuZGVyZXIiLCJfaXRlbXMiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwicmVuZGVySXRlbXMiLCJpdGVtIiwiYWRkSXRlbSIsImVsZW1lbnQiLCJwcmVwZW5kIiwicHJlcGVuZEl0ZW0iLCJhZGRGb3JtVmFsaWRhdG9yIiwiRm9ybVZhbGlkYXRvciIsInByb2ZpbGVGb3JtVmFsaWRhdG9yIiwiYXZhdGFyRm9ybVZhbGlkYXRvciIsIl9jb25maXJtQnV0dG9uIiwiX3NhdmVCdXR0b24iLCJfaGFuZGxlRGVsZXRlU3VibWl0IiwiYWN0aW9uIiwiZWRpdEZvcm1Nb2RhbCIsImFkZEZvcm1Nb2RhbCIsInVwZGF0ZVByb2ZpbGVGb3JtIiwiX3ByZXZpZXdJbWFnZUVsZW1lbnQiLCJfcHJldmlld0ltYWdlQ2FwdGlvbiJdLCJzb3VyY2VSb290IjoiIn0=